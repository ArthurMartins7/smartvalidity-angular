<!-- Cabeçalho unificado -->
<div class="bg-gray-100 -mx-6 md:-mx-6 py-6 mb-10">
  <div class="flex items-center gap-2 px-6">
    <!-- Botão voltar -->
    <button (click)="voltar()" class="p-1 hover:bg-gray-200 rounded transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
  </button>

    <!-- Títulos -->
  <div>
      <div class="text-gray-500 text-base cursor-pointer hover:underline" (click)="voltar()">Mural de Produtos</div>
      <div class="text-3xl font-bold">Detalhes do Produto</div>
      <p class="text-gray-800 text-base mt-1">Informações detalhadas do lote selecionado e status de inspeção.</p>
    </div>
  </div>
</div>

<!-- Loading e erros -->
<div *ngIf="loading" class="flex justify-center items-center py-10">
  <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
</div>

<div *ngIf="error" class="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded mb-4 mx-6">
  <p>{{ error }}</p>
</div>

<!-- Card principal -->
<div *ngIf="item && !loading" class="bg-white rounded-lg shadow-md overflow-hidden mx-6">
  <!-- Cabeçalho do card -->
  <div class="bg-gray-50 p-4 border-b">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
      <h3 class="text-lg font-bold text-gray-800">{{ item.produto.descricao }}</h3>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              [class]="item.inspecionado ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
          {{ item.inspecionado ? 'Inspecionado' : 'Não inspecionado' }}
        </span>
        <div class="px-2.5 py-0.5 rounded-full text-xs font-medium"
           [ngClass]="{
             'bg-yellow-100 text-yellow-800': item.status === 'proximo',
             'bg-orange-100 text-orange-800': item.status === 'hoje',
             'bg-red-100 text-red-800': item.status === 'vencido'
           }">
        {{ item.status === 'proximo' ? 'Próximo a vencer' :
           item.status === 'hoje' ? 'Vence hoje' :
           'Vencido' }}
    </div>
  </div>

      <!-- Botão Inspecionar -->
    <button
      *ngIf="!item.inspecionado"
        (click)="abrirModalInspecao()"
        [disabled]="processandoInspecao"
        class="flex items-center px-4 py-1.5 rounded-md text-sm font-medium focus:outline-none text-white transition-colors"
        style="background-color:#5084C1;"
        onmouseover="this.style.backgroundColor='#3d6ba3'"
        onmouseout="this.style.backgroundColor='#5084C1'">
      <ng-container *ngIf="!processandoInspecao">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
          Inspecionar
      </ng-container>
      <ng-container *ngIf="processandoInspecao">
        <div class="animate-spin rounded-full h-4 w-4 mr-2 border-t-2 border-b-2 border-white"></div>
        Processando...
      </ng-container>
    </button>
    </div>
  </div>

  <!-- Conteúdo do card -->
  <div class="p-6 overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 text-sm">
      <tbody class="divide-y divide-gray-200">
        <!-- Informações do produto -->
        <tr>
          <th class="w-1/3 text-left font-semibold text-gray-600 py-2">Descrição</th>
          <td class="py-2 text-gray-800">{{ item.produto.descricao }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Código de Barras</th>
          <td class="py-2 text-gray-800">{{ item.produto.codigoBarras }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Marca</th>
          <td class="py-2 text-gray-800">{{ item.produto.marca }}</td>
        </tr>
        <!-- Lote e localização -->
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Lote</th>
          <td class="py-2 text-gray-800">{{ item.lote }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Categoria</th>
          <td class="py-2 text-gray-800">{{ item.categoria }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Corredor</th>
          <td class="py-2 text-gray-800">{{ item.corredor }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Fornecedor</th>
          <td class="py-2 text-gray-800">{{ item.fornecedor }}</td>
        </tr>
        <!-- Prazos -->
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Data de Fabricação</th>
          <td class="py-2 text-gray-800">{{ item.dataFabricacao | date:'dd/MM/yyyy' }} <span class="text-xs text-gray-500">{{ item.dataFabricacao | date:'HH:mm:ss' }}</span></td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Data de Recebimento</th>
          <td class="py-2 text-gray-800">{{ item.dataRecebimento | date:'dd/MM/yyyy' }}</td>
        </tr>
        <tr>
          <th class="text-left font-semibold text-gray-600 py-2">Data de Vencimento</th>
          <td class="py-2 text-gray-800">{{ item.dataValidade | date:'dd/MM/yyyy' }} <span class="text-xs text-gray-500">{{ item.dataValidade | date:'HH:mm:ss' }}</span></td>
        </tr>
        <!-- Inspeção -->
        <tr *ngIf="item.inspecionado && item.motivoInspecao">
          <th class="text-left font-semibold text-gray-600 py-2">Motivo da Inspeção</th>
          <td class="py-2 text-gray-800">{{ item.motivoInspecao }}</td>
        </tr>
        <tr *ngIf="item.inspecionado && item.usuarioInspecao">
          <th class="text-left font-semibold text-gray-600 py-2">Inspecionado por</th>
          <td class="py-2 text-gray-800">{{ item.usuarioInspecao }}</td>
        </tr>
        <tr *ngIf="item.inspecionado && item.dataHoraInspecao">
          <th class="text-left font-semibold text-gray-600 py-2">Data/Hora da Inspeção</th>
          <td class="py-2 text-gray-800">{{ item.dataHoraInspecao | date:'dd/MM/yyyy HH:mm:ss' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Rodapé: aviso de já inspecionado -->
  <div *ngIf="item.inspecionado" class="border-t px-5 py-3 flex items-center text-green-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span class="font-medium">Produto já inspecionado</span>
    </div>
</div>

<!-- Modal de inspeção -->
<app-modal-inspecao (inspecaoConfirmada)="onInspecaoConfirmada()"></app-modal-inspecao>
